<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD6e5KCfZHZEoJLPDVUn24zM-30hir0CwM&sensor=true"></script>

<%= form_tag schools_path, :method => 'get' do  %>
  <div><%= text_field_tag :zip, params[:zip], :placeholder => "enter zip code"%> <%= submit_tag 'Search' %></div>
<% end %>

<br />
<div class="row">
  <div class="col-lg-6 col-md-6">
  <% @schools.each do |school| %>
      <div>ID: <%= school.id %></div>
      <div><strong><%= school.name %></strong></div>
      <div><%= school.address %></div>
      <div><%= school.city %>, <%= school.state %> <%= school.zip %></div>
      <div><%= school.county %> County</div>
      <div><%= school.phone_number %></div>
      <div><%= school.url %></div>
      <div><%= school.grade_level %></div>
      <div><%= school.rating %></div>
      <div><%= school.is_religious %></div>
      <div><%= school.latitude %>, <%= school.longitude %></div>
      <div><%= link_to 'Edit', edit_school_path(school) %> |
      <%= link_to 'Show', school_path(school) %></div> 
      <hr/>
  <% end %>
  </div>
  
  <div class="col-lg-6 col-md-6">
    <div id="map-canvas"></div>
  </div>
</div>
 
 <div id="runThis">CLick me!!!</div>

<script type="text/javascript"> 
  $('#runThis').click(function(){
    initialize();
  })
  
  function initialize() {

    $.get(location.href, null)
      .success(function(data){

    var school_array = [];

    // for (i=0; i < schools.length; i++){
    <% @schools.each do |school| %>
      school_array.push(new google.maps.LatLng(<%= school.latitude %>, <%= school.longitude %>))
    <% end %>
    // }

    var mapOptions = {
      zoom: 13,
      center: (school_array[0])
    }

    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    for(var i=0; i < school_array.length; i++)
      {
        var marker = new google.maps.Marker({
          position: school_array[i],
          map: map
        })
      }
    });
  }
  google.maps.event.addDomListener(window, 'page:change', initialize);
</script>
